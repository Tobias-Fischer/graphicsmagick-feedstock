{% set version = "1.3.33" %}

package:
  name: graphicsmagick
  version: {{ version }}

source:
  - url: https://sourceforge.net/projects/graphicsmagick/files/graphicsmagick/{{ version }}/GraphicsMagick-{{ version }}.tar.bz2
    sha256: d18aaca2d79a10270d49ad1aaa01dce24752f7548880138d59874a78ac62e11f
  - path: CMakeLists.txt

build:
  number: 1
  # ghostscript and gnuplot not available
  skip: True  # [win and vc<14]

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - cmake  # [win]
    - ninja  # [win]
  host:
    - ghostscript  # [unix]
    - gnuplot  # [unix]
    - xorg-libsm  # [unix]
    - libwebp  # [unix]
    - xorg-libxext  # [unix]
    - xorg-libxdmcp  # [unix]
    - xorg-libxau  # [unix]
    - libxml2  # [unix]
    - xz  # [unix]
    - bzip2
    - jpeg
    - libpng
    - freetype
    - libtiff
    - zlib
  run:
    - ghostscript  # [unix]
    - gnuplot  # [unix]
    - xorg-libsm  # [unix]
    - libwebp  # [unix]
    - xorg-libxext  # [unix]
    - xorg-libxdmcp  # [unix]
    - xorg-libxau  # [unix]
    - libxml2  # [unix]
    - xz  # [unix]
    - bzip2
    - jpeg
    - libpng
    - freetype
    - libtiff
    - zlib

test:
  commands:
    - gm -help
    - if not exist %LIBRARY_PREFIX%\\bin\\GraphicsMagick.dll exit 1  # [win]
    - if not exist %LIBRARY_PREFIX%\\bin\\GraphicsMagick++.dll exit 1  # [win]
    - if not exist %LIBRARY_PREFIX%\\bin\\GraphicsMagickWand.dll exit 1  # [win]

about:
  home: http://www.graphicsmagick.org/
  license: MIT
  license_file: Copyright.txt
  summary: GraphicsMagick is the swiss army knife of image processing

extra:
  recipe-maintainers:
    - bgruening
    - seanyen
